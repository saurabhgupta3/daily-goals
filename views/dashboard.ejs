<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dashboard</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h1>Welcome <%=username%></h1>
        <h1 class="alerthai">Please don't change me, Just trust me</h1>
        <p class="para">Tumhare man me ye jo baat aa rhi hai ise mat mano ye har bar aisa hi karta hai aise hi bar bar change karte rahoge to kaise ho payega. Ye tumhe kahega ki ab sabse badiya schedule hai isko karunga to sabse achha hoga par manana mat bas yahi follow karo ye bas kaam talna chahta hai tumhare man...TRUST ME</p>

        <p class="para2">Agar ye complete na ho to pareshan hokar ise change mat kardena ye mat sochana ki isse acha mai aisa banaun jo roj poora sakun vishwas mano agar tum ise hi kar rahe ho then you are doing more than other days. It not mattes whether it completes or NOT</p>
        <form action="/add" method="get">
            <input type="hidden" name="username" value="<%=username%>" />
            <button>add</button>
        </form>
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th style="display: flex; gap: 10px;"><form action="/record" method="get">
                            <%let total = 0;%>
                            <% let cnt = 0; %>
                            <% for(let data of allData) {%>
                                <% if(data.check) { %>
                                    <% cnt++; %>
                                <% }%>
                                <% total++; %>
                            <%}%>
                            <% let percentage = (cnt/total) * 100; %>
                            <% percentage = Math.ceil(percentage) %>
                            <input type="hidden" name="percentage" value="<%= percentage %>">
                            <input type="hidden" name="username" value="<%= username %>">
                            <button>record</button>
                        </form>
                        <form action="/details" method="get">
                            <input type="hidden" name="username" value="<%= username %>">
                            <button>details</button>
                        </form>
                    </th>
                </tr>
            </thead>
            <tbody>
                <%for(let data of allData) {%>
                <tr>
                    <td><%=data.title%></td>
                    <td><%=data.description%></td>
                    <td>
                        <form action="/update" method="POST">
                            <input type="hidden" name="username", value="<%= username %>">
                            <input type="hidden" name="_id" value="<%=data._id%>">
                            <input type="checkbox" name="check"
                            onchange="this.form.submit()" <%= data.check ?
                            'checked' : '' %> >
                        </form>
                    </td>
                    <td>
                        <form action="/delete?_method=delete" method="post">
                            <input type="hidden" name="_id" value="<%= data._id %>">
                            <input type="hidden" name="username", value="<%= username %>">
                            <button>delete</button>
                        </form>
                    </td>
                </tr>
                <%}%>
            </tbody>
        </table>
    </body>
</html>
